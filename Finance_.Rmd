---
title: "Finance"
author: "Milica Pajkic, Stefanie Palten"
date: "2022-12-02"
output: html_document
collapse: true
---

## Introduction

Idee: Wir vergleichen die Aktienpreise von den Meta mit zwei weiteren. Ausgangslage ist der Rückgang des Aktienpreises von Meta in den letzten Monaten (*AMZN, META Layoffs*, o. J.).

Mögliche Arten die Arbeit "origineller machen"

-   Es wird oft ein Vergleich mit der Dot.Com Bubble gezogen zu der jetztigen Situation. Ist dieser Vergleich valide?

-   Prophet Analyse Tool von Meta (<https://www.geeksforgeeks.org/time-series-analysis-using-facebook-prophet-in-r-programming/>)

## Overview

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

```{r packages, include = FALSE}
library(quantmod)
library(ggplot2)
library(forecast)
library(tseries)
library(rugarch)
library(prophet)
library(tsfknn)
library(TTR)
library(PerformanceAnalytics)
library(lmtest)
```

```{r load META, include=FALSE}
data <- NULL
tickers_index <- c("META") # Ticker from Yahoo Finance for the SMI

for (Ticker in tickers_index){
  data <- cbind(data,
                getSymbols.yahoo(Ticker, from="2012-05-19", 
                                 periodicity = "weekly", 
                                 auto.assign=FALSE)[,6])
}

META <- data
colnames(META) <- c("META")

```

```{r, include=FALSE}
summary(META)
```

```{r}
lineChart(META,theme = chartTheme("black"))

```

```{r}
barChart(META,theme=chartTheme("white"))
addSMA(n=5,col="darkblue")
addSMA(n=21,col="darkred")
legend("bottomright",col=c("darkblue","darkred"),lty=1,legend = c("SMA(5)","SMA(21)"),cex=0.6)
```

## Identification Phase

This chapter will be providing a short descriptive analysis of the tech companies stock prices since their launch.

```{r,collapsed=TRUE}
plot(META, main="META")
```

## Estimation Phase

### ARIMA

The ARIMA model combines the following methods:

-   Auto regression

-   differencing

-   Moving average

First step in the ARIMA process is determining if it is stationarity.

```{r}
adf.test(META)
```

It is not stationary therefore we have to do some modelling.

```{r}
META_returns <- na.omit(diff(log(META)))
plot(META_returns, main="META Returns", ylab=NULL)
adf.test(META_returns)
```

It is now stationary, because the adf-Test shows a value below 0.01

```{r Identifying the orders p and q of the ARIMA(p,1,q)-model by testing different model specifications, include=FALSE}

max.order <- 2 # We only allow a maximum of two AR- and/or MA-terms 
d <- 1 
# Defining the matrix in which the values of the AICs for different model specifications are stored
arima_aic <- matrix(NA, ncol=max.order+1, nrow=max.order+1)
row.names(arima_aic) <- c(0:max.order) # Order of AR(p) in rows
colnames(arima_aic) <- c(0:max.order) # Order of MA(q) in columns

# Calculating and storing the AICs for different model specifications
for(i in 0:max.order){
  for(j in 0:max.order){
    arima_aic[i+1,j+1]<-Arima(y=log(META), order=c(i,d,j), include.constant =  TRUE)$aic
  }
}
arima_aic
```

```{r Finding the model specification which minimizes the AIC}

index <- which(arima_aic == min(arima_aic), arr.ind = TRUE)
ar <- as.numeric(rownames(arima_aic)[index[1]])
ma <- as.numeric(colnames(arima_aic)[index[2]])
```

```{r Estimating the optimal ARIMA-model and testing for significance of the coefficients}

arima <- Arima(y=log(META), order=c(ar,1,ma), include.constant = TRUE)
coeftest(arima)
```

```{r Estimating the orders of the ARIMA(p,d,q) automatically}
arima <- auto.arima(log(META), ic="aic")
arima
```

```{r, include = FALSE, warning=FALSE}
pred <- forecast(arima,level=0.95,h=20)
plot(pred, ylab="META") + grid()
```

This model does not satisfy and another possible model should be pursued. GARCH could provide better results.

### GARCH

```{r Calculate continuous returns ("stetige Renditen") and test for stationarity}

Returns<-na.omit(diff(log(BTC)))
colnames(Returns)<-"BTC Returns"
plot(Returns)
adf.test(Returns)
```

```{r Compute the rolling 1 month estimate of annualized volatility}
chart.RollingPerformance(R = Returns, width = 30,
                         FUN = "sd.annualized", scale = 252, main = "One month rolling volatility")
```

```{r  Determine the ARMA lag orders}
auto.arima(Returns)
```

```{r Specify a standard GARCH model}

garchspec <- ugarchspec(mean.model = list(armaOrder = c(1,1)),
                        variance.model = list(garchOrder = c(1,1), model = "sGARCH"))
```

```{r}
# Estimate the model
garchfit <- ugarchfit(data = Returns, spec = garchspec)

# Use the method sigma to retrieve the estimated volatilities 
garchvol <- sigma(garchfit)

# Plot the GARCH and realized volatility
par(mfrow=c(2,1)) 
plot(garchvol, main="GARCH volatility")
plot(abs(Returns), main="Realized volatility")
```

```{r Forecast returns and volatility}

garchforecast <- ugarchforecast(fitORspec = garchfit, n.ahead = 5)
plot(garchforecast, which=1)
plot(garchforecast, which=3)
```

## Excursion: Dot.Com Bubble Now vs. then

```{r}
data <- NULL
tickers_index <- c("^IXIC") # Ticker from Yahoo Finance for the SMI

for (Ticker in tickers_index){
  data <- cbind(data,
                getSymbols.yahoo(Ticker, from="1990-01-01", periodicity = "monthly", auto.assign=FALSE)[,6])
}

nasdaq <- data
colnames(nasdaq) <- c("nasdaq")
plot(nasdaq)
```
